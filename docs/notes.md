## Overview

- ipybox is a Python code execution sandbox with first class support for calling and composing MCP servers in Python code 
- ipybox generates Python wrapper functions for MCP server tools from their schema definitions
- ipybox supports Python wrapper function generation from both, local stdio and http MCP servers

- Python code that calls the generated functions is executed in a sandboxed IPython kernel
- MCP servers are executed in a managed environment that supports tool call approval
- ipybox can execute code from any Python package given sufficient sandbox permissions

## Interfaces

- ipybox Python SDK: high-level Python API for function generation, execution and approval
- ipybox MCP server: MCP server for agents to register and call MCP tools via code actions

## Application context

- ipybox is designed for agents that interact with their environment via code actions
- agents act by generating and executing Python code instead of calling tools via JSON 
- code actions generated by agents may include calls to MCP functions generated by ipybox 
- Code generation enables agents to compose multiple tool calls into a single code action
- Code actions cannot be trusted and must be executed in a secure execution environment
- Applications must be able to approve any MCP tool call during code action execution

## Important aspects

- Local code execution, sandboxed or not, no cloud dependencies or API keys required
- Generating code for calling MCP server tools is more reliable than tool calls via JSON
- Generated code actions can be saved locally and reused as skills in other code actions

## Key packages, modules, classes and functions

- `ipybox.code_exec.server.KernelGateway` manages a Jupyter Kernel Gateway and runs it in a sandboxed environment using Anthropic's `srt`.
- `ipybox.code_exec.client.KernelClient` creates an Ipython kernel via the Kernel Gateway and provides methods for stateful code execution in that kernel.

- `ipybox.tool_exec.server.ToolServer` manages MCP servers and provides endpoints for MCP tool execution. Enforces tool call approval via `ApprovalChannel`.
- `ipybox.tool_exec.client.ToolRunner` executes tools of MCP servers running on `ToolServer`. Used by generated Python functions to run MCP tools.

- `ipybox.tool_exec.approval.server.ApprovalChannel` sends tool call approval requests to `ApprovalClient`.
- `ipybox.tool_exec.approval.client.ApprovalClient` requests tool call approval from an application via a callback.

- `ipybox.mcp_apigen.generate_mcp_sources` generates Python functions for tools of an MCP server from their schema definitions. 
- `ipybox.mcp_server.MCPServer` provides MCP function generation and code execution capabilities to agents. Manages and embedded `KernelGateway` and `ToolServer`.
- `ipybox.facade.CodeExecutor` is the main interface for code execution, MCP tool execution and approval. Manages an embedded `KernelGateway` and `ToolServer`.
